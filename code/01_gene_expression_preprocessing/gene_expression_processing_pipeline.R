# Data:
#Input: GSE88794_RAW.tarâ€¨
#Output: processed_expression_data.txt, intermediate_data.txt, gene_symbol_expression_data.txt

# Code
# # Extract the TAR file
# untar("GSE88794_RAW.tar")

# Bash commands

# (base) douglas@Douglass-MacBook-Air GEO TAR (of CEL) Data % pwd
# /Users/douglas/Library/CloudStorage/OneDrive-UniversityCollegeCork/Msc Bioinformatics and Computational Biology/MB6303 Dissertion in Bioinformatics & Computational Biology/Practical Work/GEO TAR (of CEL) Data
# (base) douglas@Douglass-MacBook-Air Practical Work % cd GEO\ TAR\ \(of\ CEL\)\ Data
# (base) douglas@Douglass-MacBook-Air GEO TAR (of CEL) Data % find . -type f ! -name '*W5D2T0*.CEL.gz' \
# ! -name '*W5D2T120*.CEL.gz' \
# ! -name '*W5D3T0*.CEL.gz' \
# ! -name '*W5D3T120*.CEL.gz' \
# ! -name '*W18D2T0*.CEL.gz' \
# ! -name '*W18D2T120*.CEL.gz' \
# ! -name '*W18D3T0*.CEL.gz' \
# ! -name '*W18D3T120*.CEL.gz' \
# -delete
# 
# 
# (base) douglas@Douglass-MacBook-Air GEO TAR (of CEL) Data % ls
# GSM2346493_A01_NT001-W5D2T0.CEL.gz	GSM2346858_C03_NT067-W5D3T0.CEL.gz	GSM2347278_E10_NT043-W5D2T120.CEL.gz
# GSM2346494_A01_NT010-W5D2T0.CEL.gz	GSM2346859_C03_NT078-W5D3T0.CEL.gz	GSM2347279_E10_NT053-W5D2T120_2.CEL.gz
# GSM2346495_A01_NT018-W5D2T0.CEL.gz	GSM2346860_C03_NT089-W5D3T0.CEL.gz	GSM2347280_E10_NT064-W5D2T120.CEL.gz
# GSM2346496_A01_NT025-W5D2T0.CEL.gz	GSM2346861_C03_NT118-W5D3T0.CEL.gz	GSM2347281_E10_NT072-W5D2T120_2.CEL.gz
# GSM2346497_A01_NT034-W5D2T0.CEL.gz	GSM2346862_C03_NT131-W5D3T0.CEL.gz	GSM2347282_E10_NT082-W5D2T120.CEL.gz
# GSM2346498_A01_NT045-W5D2T0.CEL.gz	GSM2346863_C03_NT145-W5D3T0.CEL.gz	GSM2347283_E10_NT104-W5D2T120.CEL.gz
# GSM2346499_A01_NT056-W5D2T0.CEL.gz	GSM2346878_C04_NT151-W5D3T120.CEL.gz	GSM2347284_E10_NT123-W5D2T120.CEL.gz
# GSM2346500_A01_NT066-W5D2T0.CEL.gz	GSM2346879_C05_NT002-W5D3T120.CEL.gz	GSM2347285_E10_NT137-W5D2T120.CEL.gz
# GSM2346501_A01_NT077-W5D2T0.CEL.gz	GSM2346880_C05_NT013-W5D3T120.CEL.gz	GSM2347286_E10_NT147-W5D2T120.CEL.gz
# GSM2346502_A01_NT090-W5D2T0.CEL.gz	GSM2346881_C05_NT020-W5D3T120.CEL.gz	GSM2347338_F03_NT008-W5D3T0.CEL.gz
# GSM2346503_A01_NT114-W5D2T0.CEL.gz	GSM2346882_C05_NT027-W5D3T120.CEL.gz	GSM2347339_F03_NT017-W5D3T0.CEL.gz
# GSM2346504_A01_NT129-W5D2T0.CEL.gz	GSM2346883_C05_NT035-W5D3T120.CEL.gz	GSM2347340_F03_NT023-W5D3T0.CEL.gz
# GSM2346505_A01_NT143-W5D2T0.CEL.gz	GSM2346884_C05_NT046-W5D3T120.CEL.gz	GSM2347341_F03_NT032-W5D3T0.CEL.gz
# GSM2346506_A01_NT150-W5D2T0.CEL.gz	GSM2346885_C05_NT057-W5D3T120.CEL.gz	GSM2347342_F03_NT043-W5D3T0.CEL.gz
# GSM2346535_A04_NT001-W5D2T120.CEL.gz	GSM2346886_C05_NT067-W5D3T120.CEL.gz	GSM2347343_F03_NT053-W5D3T0.CEL.gz
# GSM2346536_A04_NT010-W5D2T120.CEL.gz	GSM2346887_C05_NT078-W5D3T120.CEL.gz	GSM2347344_F03_NT064-W5D3T0.CEL.gz
# GSM2346537_A04_NT018-W5D2T120.CEL.gz	GSM2346888_C05_NT089-W5D3T120.CEL.gz	GSM2347345_F03_NT072-W5D3T0_2.CEL.gz
# GSM2346538_A04_NT025-W5D2T120.CEL.gz	GSM2346889_C05_NT118-W5D3T120.CEL.gz	GSM2347346_F03_NT082-W5D3T0.CEL.gz
# GSM2346539_A04_NT034-W5D2T120.CEL.gz	GSM2346890_C05_NT131-W5D3T120.CEL.gz	GSM2347347_F03_NT104-W5D3T0_3.CEL.gz
# GSM2346540_A04_NT045-W5D2T120.CEL.gz	GSM2346891_C05_NT145-W5D3T120.CEL.gz	GSM2347348_F03_NT123-W5D3T0.CEL.gz
# GSM2346541_A04_NT056-W5D2T120.CEL.gz	GSM2346988_C12_NT152-W5D2T0.CEL.gz	GSM2347349_F03_NT137-W5D3T0.CEL.gz
# GSM2346542_A04_NT066-W5D2T120.CEL.gz	GSM2346989_D01_NT006-W5D2T0.CEL.gz	GSM2347350_F03_NT147-W5D3T0.CEL.gz
# GSM2346543_A04_NT077-W5D2T120.CEL.gz	GSM2346990_D01_NT015-W5D2T0.CEL.gz	GSM2347364_F05_NT008-W5D3T120.CEL.gz
# GSM2346544_A04_NT090-W5D2T120.CEL.gz	GSM2346991_D01_NT021-W5D2T0.CEL.gz	GSM2347365_F05_NT017-W5D3T120.CEL.gz
# GSM2346545_A04_NT114-W5D2T120.CEL.gz	GSM2346992_D01_NT031-W5D2T0.CEL.gz	GSM2347366_F05_NT023-W5D3T120.CEL.gz
# GSM2346546_A04_NT129-W5D2T120.CEL.gz	GSM2346993_D01_NT038-W5D2T0.CEL.gz	GSM2347367_F05_NT043-W5D3T120.CEL.gz
# GSM2346547_A04_NT143-W5D2T120.CEL.gz	GSM2346994_D01_NT051-W5D2T0.CEL.gz	GSM2347368_F05_NT053-W5D3T120.CEL.gz
# GSM2346548_A04_NT150-W5D2T120.CEL.gz	GSM2346995_D01_NT059-W5D2T0.CEL.gz	GSM2347369_F05_NT064-W5D3T120.CEL.gz
# GSM2346604_A09_NT001-W5D3T0.CEL.gz	GSM2346996_D01_NT070-W5D2T0.CEL.gz	GSM2347370_F05_NT072-W5D3T120.CEL.gz
# GSM2346605_A09_NT010-W5D3T0.CEL.gz	GSM2346997_D01_NT103-W5D2T0.CEL.gz	GSM2347371_F05_NT082-W5D3T120.CEL.gz
# GSM2346606_A09_NT018-W5D3T0.CEL.gz	GSM2346998_D01_NT120-W5D2T0.CEL.gz	GSM2347372_F05_NT104-W5D3T120.CEL.gz
# GSM2346607_A09_NT025-W5D3T0.CEL.gz	GSM2346999_D01_NT132-W5D2T0.CEL.gz	GSM2347373_F05_NT123-W5D3T120.CEL.gz
# GSM2346608_A09_NT034-W5D3T0.CEL.gz	GSM2347000_D01_NT146-W5D2T0.CEL.gz	GSM2347374_F05_NT137-W5D3T120.CEL.gz
# GSM2346609_A09_NT045-W5D3T0.CEL.gz	GSM2347029_D03_NT152-W5D2T120.CEL.gz	GSM2347375_F05_NT147-W5D3T120.CEL.gz
# GSM2346610_A09_NT056-W5D3T0.CEL.gz	GSM2347030_D04_NT006-W5D2T120.CEL.gz	GSM2347467_G01_NT009-W5D2T0.CEL.gz
# GSM2346611_A09_NT066-W5D3T0.CEL.gz	GSM2347031_D04_NT015-W5D2T120.CEL.gz	GSM2347468_G01_NT033-W5D2T0.CEL.gz
# GSM2346612_A09_NT077-W5D3T0.CEL.gz	GSM2347032_D04_NT021-W5D2T120.CEL.gz	GSM2347469_G01_NT044-W5D2T0.CEL.gz
# GSM2346613_A09_NT090-W5D3T0.CEL.gz	GSM2347033_D04_NT031-W5D2T120.CEL.gz	GSM2347470_G01_NT055-W5D2T0.CEL.gz
# GSM2346614_A09_NT114-W5D3T0.CEL.gz	GSM2347034_D04_NT038-W5D2T120.CEL.gz	GSM2347471_G01_NT060-W5D2T0.CEL.gz
# GSM2346615_A09_NT129-W5D3T0.CEL.gz	GSM2347035_D04_NT051-W5D2T120.CEL.gz	GSM2347472_G01_NT065-W5D2T0.CEL.gz
# GSM2346616_A09_NT143-W5D3T0.CEL.gz	GSM2347036_D04_NT059-W5D2T120.CEL.gz	GSM2347473_G01_NT076-W5D2T0.CEL.gz
# GSM2346617_A09_NT150-W5D3T0.CEL.gz	GSM2347037_D04_NT070-W5D2T120.CEL.gz	GSM2347474_G01_NT084-W5D2T0.CEL.gz
# GSM2346632_A11_NT001-W5D3T120.CEL.gz	GSM2347038_D04_NT080-W5D2T120.CEL.gz	GSM2347475_G01_NT106-W5D2T0.CEL.gz
# GSM2346633_A11_NT010-W5D3T120.CEL.gz	GSM2347039_D04_NT103-W5D2T120.CEL.gz	GSM2347476_G01_NT125-W5D2T0.CEL.gz
# GSM2346634_A11_NT018-W5D3T120.CEL.gz	GSM2347040_D04_NT120-W5D2T120.CEL.gz	GSM2347477_G01_NT133-W5D2T0.CEL.gz
# GSM2346635_A11_NT025-W5D3T120.CEL.gz	GSM2347041_D04_NT132-W5D2T120.CEL.gz	GSM2347478_G01_NT140-W5D2T0.CEL.gz
# GSM2346636_A11_NT034-W5D3T120.CEL.gz	GSM2347042_D04_NT146-W5D2T120.CEL.gz	GSM2347479_G01_NT148-W5D2T0.CEL.gz
# GSM2346637_A11_NT045-W5D3T120.CEL.gz	GSM2347097_D08_NT152-W5D3T0.CEL.gz	GSM2347506_G04_NT009-W5D2T120.CEL.gz
# GSM2346638_A11_NT056-W5D3T120.CEL.gz	GSM2347098_D09_NT006-W5D3T0.CEL.gz	GSM2347508_G04_NT044-W5D2T120.CEL.gz
# GSM2346639_A11_NT066-W5D3T120.CEL.gz	GSM2347099_D09_NT015-W5D3T0.CEL.gz	GSM2347509_G04_NT055-W5D2T120.CEL.gz
# GSM2346640_A11_NT077-W5D3T120.CEL.gz	GSM2347100_D09_NT021-W5D3T0.CEL.gz	GSM2347511_G04_NT065-W5D2T120.CEL.gz
# GSM2346641_A11_NT090-W5D3T120.CEL.gz	GSM2347101_D09_NT031-W5D3T0.CEL.gz	GSM2347512_G04_NT076-W5D2T120.CEL.gz
# GSM2346642_A11_NT114-W5D3T120.CEL.gz	GSM2347102_D09_NT038-W5D3T0_2.CEL.gz	GSM2347513_G04_NT084-W5D2T120.CEL.gz
# GSM2346643_A11_NT129-W5D3T120.CEL.gz	GSM2347103_D09_NT051-W5D3T0.CEL.gz	GSM2347514_G04_NT106-W5D2T120.CEL.gz
# GSM2346644_A11_NT143-W5D3T120.CEL.gz	GSM2347104_D09_NT059-W5D3T0.CEL.gz	GSM2347515_G04_NT125-W5D2T120.CEL.gz
# GSM2346645_A11_NT150-W5D3T120.CEL.gz	GSM2347105_D09_NT070-W5D3T0.CEL.gz	GSM2347516_G04_NT133-W5D2T120.CEL.gz
# GSM2346741_B07_NT002-W5D2T0.CEL.gz	GSM2347106_D09_NT080-W5D3T0_2.CEL.gz	GSM2347517_G04_NT140-W5D2T120.CEL.gz
# GSM2346742_B07_NT013-W5D2T0.CEL.gz	GSM2347107_D09_NT103-W5D3T0.CEL.gz	GSM2347518_G04_NT148-W5D2T120.CEL.gz
# GSM2346743_B07_NT020-W5D2T0.CEL.gz	GSM2347108_D09_NT120-W5D3T0.CEL.gz	GSM2347546_G07_NT033-W5D3T0.CEL.gz
# GSM2346744_B07_NT027-W5D2T0.CEL.gz	GSM2347109_D09_NT132-W5D3T0.CEL.gz	GSM2347549_G07_NT060-W5D3T0.CEL.gz
# GSM2346745_B07_NT035-W5D2T0.CEL.gz	GSM2347110_D09_NT146-W5D3T0.CEL.gz	GSM2347571_G09_NT022-W5D2T0.CEL.gz
# GSM2346746_B07_NT046-W5D2T0.CEL.gz	GSM2347125_D10_NT152-W5D3T120.CEL.gz	GSM2347572_G09_NT033-W5D3T120.CEL.gz
# GSM2346747_B07_NT057-W5D2T0.CEL.gz	GSM2347126_D11_NT006-W5D3T120.CEL.gz	GSM2347573_G09_NT044-W5D3T0.CEL.gz
# GSM2346748_B07_NT067-W5D2T0.CEL.gz	GSM2347127_D11_NT015-W5D3T120.CEL.gz	GSM2347574_G09_NT055-W5D3T0_2.CEL.gz
# GSM2346749_B07_NT078-W5D2T0.CEL.gz	GSM2347128_D11_NT021-W5D3T120.CEL.gz	GSM2347575_G09_NT060-W5D3T120.CEL.gz
# GSM2346750_B07_NT089-W5D2T0.CEL.gz	GSM2347129_D11_NT031-W5D3T120.CEL.gz	GSM2347576_G09_NT065-W5D3T0.CEL.gz
# GSM2346751_B07_NT118-W5D2T0.CEL.gz	GSM2347130_D11_NT038-W5D3T120.CEL.gz	GSM2347577_G09_NT076-W5D3T0.CEL.gz
# GSM2346752_B07_NT131-W5D2T0.CEL.gz	GSM2347131_D11_NT051-W5D3T120.CEL.gz	GSM2347578_G09_NT084-W5D3T0.CEL.gz
# GSM2346753_B07_NT145-W5D2T0.CEL.gz	GSM2347132_D11_NT059-W5D3T120.CEL.gz	GSM2347579_G09_NT106-W5D3T0.CEL.gz
# GSM2346754_B07_NT151-W5D2T0.CEL.gz	GSM2347133_D11_NT070-W5D3T120.CEL.gz	GSM2347580_G09_NT125-W5D3T0.CEL.gz
# GSM2346782_B10_NT002-W5D2T120.CEL.gz	GSM2347134_D11_NT080-W5D3T120.CEL.gz	GSM2347581_G09_NT133-W5D3T0.CEL.gz
# GSM2346783_B10_NT013-W5D2T120.CEL.gz	GSM2347135_D11_NT103-W5D3T120.CEL.gz	GSM2347582_G09_NT140-W5D3T0.CEL.gz
# GSM2346784_B10_NT020-W5D2T120.CEL.gz	GSM2347136_D11_NT120-W5D3T120.CEL.gz	GSM2347583_G09_NT148-W5D3T0.CEL.gz
# GSM2346785_B10_NT027-W5D2T120.CEL.gz	GSM2347137_D11_NT132-W5D3T120.CEL.gz	GSM2347594_G10_NT140-W5D3T120.CEL.gz
# GSM2346786_B10_NT035-W5D2T120.CEL.gz	GSM2347138_D11_NT146-W5D3T120.CEL.gz	GSM2347598_G11_NT044-W5D3T120.CEL.gz
# GSM2346787_B10_NT046-W5D2T120_2.CEL.gz	GSM2347235_E07_NT008-W5D2T0.CEL.gz	GSM2347599_G11_NT055-W5D3T120.CEL.gz
# GSM2346788_B10_NT057-W5D2T120.CEL.gz	GSM2347236_E07_NT017-W5D2T0.CEL.gz	GSM2347601_G11_NT065-W5D3T120_2.CEL.gz
# GSM2346789_B10_NT067-W5D2T120.CEL.gz	GSM2347237_E07_NT023-W5D2T0.CEL.gz	GSM2347602_G11_NT076-W5D3T120.CEL.gz
# GSM2346790_B10_NT078-W5D2T120.CEL.gz	GSM2347238_E07_NT032-W5D2T0.CEL.gz	GSM2347603_G11_NT084-W5D3T120.CEL.gz
# GSM2346791_B10_NT089-W5D2T120.CEL.gz	GSM2347239_E07_NT043-W5D2T0.CEL.gz	GSM2347604_G11_NT106-W5D3T120.CEL.gz
# GSM2346792_B10_NT118-W5D2T120.CEL.gz	GSM2347240_E07_NT053-W5D2T0.CEL.gz	GSM2347605_G11_NT125-W5D3T120_2.CEL.gz
# GSM2346793_B10_NT131-W5D2T120.CEL.gz	GSM2347241_E07_NT064-W5D2T0.CEL.gz	GSM2347606_G11_NT133-W5D3T120.CEL.gz
# GSM2346794_B10_NT145-W5D2T120.CEL.gz	GSM2347242_E07_NT072-W5D2T0.CEL.gz	GSM2347608_G11_NT148-W5D3T120.CEL.gz
# GSM2346795_B10_NT151-W5D2T120.CEL.gz	GSM2347243_E07_NT082-W5D2T0.CEL.gz	GSM2347648_H03_NT022-W5D3T0.CEL.gz
# GSM2346850_C02_NT151-W5D3T0_2.CEL.gz	GSM2347244_E07_NT104-W5D2T0.CEL.gz	GSM2347674_H05_NT022-W5D3T120.CEL.gz
# GSM2346851_C03_NT002-W5D3T0.CEL.gz	GSM2347245_E07_NT123-W5D2T0.CEL.gz	GSM2347675_H05_NT041-W5D2T0.CEL.gz
# GSM2346852_C03_NT013-W5D3T0.CEL.gz	GSM2347246_E07_NT137-W5D2T0.CEL.gz	GSM2347684_H05_NT141-W5D2T0.CEL.gz
# GSM2346853_C03_NT020-W5D3T0.CEL.gz	GSM2347247_E07_NT147-W5D2T0.CEL.gz	GSM2347685_H05_NT142-W5D2T0.CEL.gz
# GSM2346854_C03_NT027-W5D3T0.CEL.gz	GSM2347274_E10_NT008-W5D2T120.CEL.gz	GSM2347705_H08_NT041-W5D2T120.CEL.gz
# GSM2346855_C03_NT035-W5D3T0.CEL.gz	GSM2347275_E10_NT017-W5D2T120.CEL.gz	GSM2347706_H08_NT141-W5D2T120.CEL.gz
# GSM2346856_C03_NT046-W5D3T0.CEL.gz	GSM2347276_E10_NT023-W5D2T120.CEL.gz	GSM2347707_H08_NT142-W5D2T120.CEL.gz
# GSM2346857_C03_NT057-W5D3T0.CEL.gz	GSM2347277_E10_NT032-W5D2T120.CEL.gz

# Load the libraries
library(oligo)
library(affycoretools)
library(hugene11sttranscriptcluster.db)

# Set working directory
setwd("/Users/douglas/OneDrive - University College Cork/Msc Bioinformatics and Computational Biology/MB6303 Dissertion in Bioinformatics & Computational Biology/Practical Work/VAn bussel TAR ")



# Read in the .CEL files
celFiles <- list.celfiles(listGzipped = TRUE)
affyRaw <- read.celfiles(celFiles)

# Run RMA normalization
eset <- rma(affyRaw)

# Optional: Save the raw expression values
write.exprs(eset, file = 'intermediate_data.txt')

# Annotate the expression set
anno_eset <- annotateEset(eset, pd.hugene.1.1.st.v1, columns = c("PROBEID", "SYMBOL"), multivals = "first")

# Append the new identifiers and save the processed data
eset_frame <- data.frame(fData(anno_eset), exprs(anno_eset))
filter_eset <- subset(eset_frame, !is.na(eset_frame$ID))
write.table(filter_eset, file = "processed_expression_data.txt", sep = "\t", row.names = FALSE)

head(filter_eset)

filter_eset <- filter_eset[, -c(2)]

write.table(filter_eset, file = "gene_symbol_expression_data.txt", sep = "\t", row.names = FALSE, quote = FALSE)
